<!DOCTYPE html>
<html>
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
<nav class="main-nav">
  <div class="nav-container">
    <a href="/auth/users" class="brand">Admin Dashboard</a>
    <ul>
      <li><a href="/auth/users">Auth Users</a></li>
      <li><a href="/realms/dashboard">Realms</a></li>
      <li>
        <form action="/api/logout" method="POST" class="inline-form">
          <button type="submit" class="logout-link">Logout</button>
        </form>
      </li>
    </ul>
  </div>
</nav>
<div class="content-wrapper">
  <h1>Realms Management</h1>

  <table border="1" cellpadding="8" cellspacing="0" style="border-collapse: collapse;">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Description</th>
        
        <th><button id="create-btn" popovertarget="create-modal">Add Realm</button></th>
      </tr>
    </thead>
    <tbody>
      {{#each realms}}
      <tr>
        <td>{{id}}</td>
        <td>{{name}}</td>
        <td>{{description}}</td>
        <td>
          <button class="update-btn" popovertarget="update-modal-{{id}}" 
            data-id="{{id}}" data-name="{{name}}" data-description="{{description}}">
            Update
          </button>
        
          <form action="/realms/{{id}}" method="POST" class="inline-form">
            <input type="hidden" name="_method" value="DELETE">
            <input type="hidden" name="id" value="{{id}}">
            <button type="submit" id="delete-btn"
              onclick="return confirm('Are you sure you want to delete this realm?')">
              Delete
            </button>
          </form>
        </td>
      </tr>
      
      <div id="update-modal-{{id}}" popover>
        <div style="padding: 20px; max-width: 500px;">
          <h3>Update Realm</h3>
          <form action='/realms/{{id}}' method="POST">
            <input type="hidden" name="_method" value="PUT">
            <input type="hidden" id="updateId" name="id" value="{{id}}">

            <div style="margin-bottom: 15px;">
              <label style="display: block; margin-bottom: 5px; font-weight: 600;">Name:</label>
              <input type="text" name="name" id="updateName" value="{{name}}" required
                style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div style="margin-bottom: 15px;">
              <label style="display: block; margin-bottom: 5px; font-weight: 600;">Description:</label>
              <textarea name="description" id="updateDescription" 
                style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; height: 100px;">{{description}}</textarea>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end;">
              <button type="submit"
                style="padding: 10px 20px; background: #FF4B2B; color: white; border: none; border-radius: 4px; cursor: pointer;">
                Save Changes
              </button>
              <button type="button" popovertarget="update-modal-{{id}}" popovertargetaction="hide"
                style="padding: 10px 20px; background: #f0f0f0; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
      {{/each}}
    </tbody>
  </table>

  <h2 style="margin-top: 40px; margin-bottom: 20px;">Realm Users</h2>

  {{#each realms}}
  <div style="margin-bottom: 30px; padding: 15px; background: #f9f9f9; border-radius: 4px;">
    <h3 style="margin-bottom: 15px;">{{name}} (ID: {{id}})</h3>
    <table border="1" cellpadding="8" cellspacing="0" style="border-collapse: collapse; width: 100%;">
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Email</th>
          <th>Roles</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {{#if users.length}}
          {{#each users}}
          <tr>
            <td>{{id}}</td>
            <td>{{username}}</td>
            <td>{{email}}</td>
            <td>{{roles}}</td>
            <td>
              <button style="padding: 5px 10px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                View
              </button>
            </td>
          </tr>
          {{/each}}
        {{else}}
          <tr>
            <td colspan="5" style="text-align: center; color: #999;">No users in this realm</td>
          </tr>
        {{/if}}
      </tbody>
    </table>
  </div>
  {{/each}}

  <div id="create-modal" popover>
    <div style="padding: 20px; max-width: 500px;">
      <h3>Create Realm</h3>
      <form action="/realms" method="POST" id="createRealmForm">
        <input type="hidden" name="_method" value="POST">

        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600;">Name:</label>
          <input type="text" name="name" id="createName" required
            style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>

        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600;">Description:</label>
          <textarea name="description" id="createDescription" 
            style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; height: 100px;"></textarea>
        </div>

        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button type="submit"
            style="padding: 10px 20px; background: #FF4B2B; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Create Realm
          </button>
          <button type="button" popovertarget="create-modal" popovertargetaction="hide"
            style="padding: 10px 20px; background: #f0f0f0; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</body>
</html>
